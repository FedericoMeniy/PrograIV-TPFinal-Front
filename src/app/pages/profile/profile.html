<div class="profile-container" *ngIf="usuario">

  <div *ngIf="!isEditing">
    <h1>¡Hola, {{ usuario.nombre }}!</h1>
    <p>Estos son los datos de tu perfil:</p>

    <ul>
      <li>
        <strong>Nombre:</strong> {{ usuario.nombre }}
        <button (click)="toggleEdit()" class="btn-edit">Editar</button>
      </li>
      <li><strong>Email:</strong> {{ usuario.email }}</li>
      <li *ngIf="usuario.rol"><strong>Rol:</strong> {{ usuario.rol }}</li>
    </ul>

    <button (click)="logout()" class="btn btn-logout">
      Cerrar Sesión
    </button>
  </div>

  <div *ngIf="isEditing">
    <h1>Editar Perfil</h1>

    <form [formGroup]="editForm" (ngSubmit)="onSave()">
      <ul>
        <li>
          <strong>Nombre:</strong>
          <input formControlName="nombre">
        </li>
        <li><strong>Email:</strong> {{ usuario.email }}</li>
      </ul>

      <div class="form-buttons-group">
        <button type="submit" [disabled]="editForm.invalid" class="btn btn-save">
          Guardar
        </button>
        <button type="button" (click)="toggleEdit()" class="btn btn-cancel">
          Cancelar
        </button>
      </div>
    </form>

  </div>

  <!-- Nueva Sección: Mis Publicaciones -->
  <div class="mis-publicaciones-container mt-8">
    <h2 class="text-2xl font-bold mb-4">Mis Publicaciones</h2>

    <div *ngIf="misPublicaciones.length === 0" class="p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded-md">
      Aún no tienes publicaciones activas.
    </div>

    <div *ngFor="let publicacion of misPublicaciones" class="publicacion-card">
      <div class="card-header">
        <h3 class="text-xl font-semibold">{{ publicacion.auto.marca }} {{ publicacion.auto.modelo }} ({{ publicacion.auto.anio }})</h3>
        <span class="estado-tag estado-{{ publicacion.estado.toLowerCase() }}">{{ publicacion.estado }}</span>
      </div>

      <p><strong>Precio:</strong> ${{ publicacion.auto.precio | number: '1.2-2' }}</p>
      <p><strong>Descripción:</strong> {{ publicacion.descripcion }}</p>
      <p><strong>Kilometraje:</strong> {{ publicacion.auto.km }} km</p>

      <div class="card-actions">
        <!-- Botón para Marcar como Vendida -->
        <button
          (click)="marcarComoVendida(publicacion.id)"
          class="btn-vendida"
          title="Marca esta publicación como vendida y se eliminará."
        >
          Marcar como Vendida
        </button>

        <!-- Botón para Eliminar -->
        <button
          (click)="eliminarPublicacion(publicacion.id)"
          class="btn-eliminar"
          title="Eliminar permanentemente la publicación."
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>

</div>

<div *ngIf="!usuario">
  <p>No se pudieron cargar los datos del perfil. Por favor, inicia sesión.</p>
</div>